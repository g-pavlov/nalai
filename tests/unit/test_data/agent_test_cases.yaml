# Test cases for APIAssistant agent functionality

parse_response_examples:
  - name: "basic_examples"
    input:
      yaml_content:
        - intent: "Get user information"
          prompt: "How do I retrieve user data?"
          response: "You can use the GET api/v1/users endpoint"
        - intent: "Create new user"
          prompt: "How do I create a new user?"
          response: "You can use the POST api/v1/users endpoint"
    expected: "     - Intent: Get user information\n       Prompt: How do I retrieve user data?\n       Response:\nYou can use the GET api/v1/users endpoint\n\n     - Intent: Create new user\n       Prompt: How do I create a new user?\n       Response:\nYou can use the POST api/v1/users endpoint"

format_template_with_variables:
  - name: "simple_replacement"
    input:
      template: "curl -X GET https://{base_url}/api/v1/users"
      variables:
        base_url: "example.com"
    expected: "curl -X GET https://example.com/api/v1/users"
  
  - name: "multiple_replacements"
    input:
      template: "curl -X GET https://{base_url}/api/v1/users?pageSize=10&offset=0/{base_url}"
      variables:
        base_url: "example.com"
    expected: "curl -X GET https://example.com/api/v1/users?pageSize=10&offset=0/example.com"
  
  - name: "no_variables"
    input:
      template: "curl -X GET https://api.example.com/users"
      variables: {}
    expected: "curl -X GET https://api.example.com/users"

select_relevant_apis:
  - name: "single_api_selection"
    input:
      messages:
        - content: "How do I get a list of users?"
      api_summaries:
        - title: "User API"
          description: "API for user management"
          methods: ["GET", "POST"]
          version: "1.0"
          openapi_file: "core_services_v_1_0_0.yaml"
        - title: "Product API"
          description: "API for product management"
          methods: ["GET", "POST", "PUT"]
          version: "1.0"
          openapi_file: "storage_v_1_0_0.yaml"
    expected:
      selected_apis:
        - api_title: "User API"
          api_version: "1.0"
      messages_count: 1

  - name: "no_relevant_apis"
    input:
      messages:
        - content: "What's the weather like?"
      api_summaries:
        - title: "User API"
          description: "API for user management"
          methods: ["GET", "POST"]
          version: "1.0"
          openapi_file: "core_services_v_1_0_0.yaml"
    expected:
      selected_apis: []
      messages_count: 1

determine_workflow_action:
  - name: "tool_calls_present"
    input:
      messages:
        - content: "Test"
          tool_calls:
            - name: "get_http_requests"
              id: "call_1234"
              args:
                method: "GET"
                url: "https://api.example.com/users"
    expected: "call_api"
  
  - name: "no_tool_calls"
    input:
      messages:
        - content: "Just a regular message"
    expected: "__end__"
  
  - name: "empty_messages"
    input:
      messages:
        - content: "No tool calls here"
    expected: "__end__"

determine_next_step:
  - name: "with_selected_apis"
    input:
      selected_apis:
        - api_title: "User API"
          api_version: "1.0"
    expected: "load_api_specs"
  
  - name: "no_selected_apis"
    input:
      selected_apis: []
    expected: "call_model"
  
  - name: "none_selected_apis"
    input:
      selected_apis: null
    expected: "call_model" 